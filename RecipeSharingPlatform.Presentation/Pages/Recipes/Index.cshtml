@page
@model RecipeSharingPlatform.Presentation.Pages.Recipes.IndexModel
@{
    ViewData["Title"] = "Browse Recipes";
}

<style>
    .recipe-page {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem 1.25rem 4rem;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    .recipe-page__header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 1rem;
        margin-bottom: 1.25rem;
    }

    .recipe-page__title {
        font-size: 2rem;
        font-weight: 700;
        color: #111827;
    }

    .recipe-page__create-btn {
        padding: 0.55rem 1.2rem;
        border-radius: 999px;
        border: none;
        background: linear-gradient(135deg,#6366F1,#EC4899);
        color: #FFF;
        font-weight: 600;
        font-size: 0.9rem;
        text-decoration: none;
        cursor: pointer;
        white-space: nowrap;
    }

        .recipe-page__create-btn:hover {
            opacity: 0.9;
        }

    /* MY RECIPES STRIP */
    .my-recipes-strip {
        margin-bottom: 1.75rem;
        padding: 0.85rem 1rem;
        border-radius: 18px;
        background: #F9FAFB;
        border: 1px solid #E5E7EB;
    }

    .my-recipes-strip__header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 0.75rem;
        margin-bottom: 0.75rem;
    }

    .my-recipes-strip__title {
        font-size: 1.1rem;
        font-weight: 700;
        color: #111827;
    }

    .my-recipes-strip__link {
        font-size: 0.85rem;
        color: #4F46E5;
        text-decoration: none;
        font-weight: 600;
        white-space: nowrap;
    }

        .my-recipes-strip__link:hover {
            text-decoration: underline;
        }

    .my-recipes-strip__list {
        display: flex;
        gap: 0.75rem;
        overflow-x: auto;
        padding-bottom: 0.35rem;
    }

    .my-recipes-strip__card {
        min-width: 190px;
        max-width: 210px;
        background-color: #FFFFFF;
        border-radius: 14px;
        border: 1px solid #E5E7EB;
        padding: 0.6rem 0.7rem;
        display: flex;
        flex-direction: column;
        gap: 0.35rem;
        flex-shrink: 0;
    }

    .my-recipes-strip__card-title a {
        font-size: 0.92rem;
        font-weight: 600;
        color: #111827;
        text-decoration: none;
    }

        .my-recipes-strip__card-title a:hover {
            text-decoration: underline;
        }

    .my-recipes-strip__card-meta {
        font-size: 0.78rem;
        color: #6B7280;
        display: flex;
        flex-wrap: wrap;
        gap: 0.35rem;
    }

    .my-recipes-strip__card-stats {
        display: flex;
        gap: 0.55rem;
        font-size: 0.78rem;
        color: #6B7280;
    }

    .my-recipes-strip__empty {
        font-size: 0.85rem;
        color: #6B7280;
    }

    /* FILTERS */
    .recipe-filters {
        margin-bottom: 1.5rem;
    }

    .recipe-filters__row {
        display: flex;
        flex-wrap: wrap;
        gap: 0.75rem;
        align-items: center;
    }

    .recipe-filters__search,
    .recipe-filters__select {
        padding: 0.55rem 0.75rem;
        border-radius: 999px;
        border: 1px solid #D1D5DB;
        font-size: 0.9rem;
        min-width: 180px;
        background-color: #FFFFFF;
    }

        .recipe-filters__search:focus,
        .recipe-filters__select:focus {
            outline: none;
            border-color: #6366F1;
            box-shadow: 0 0 0 2px rgba(99,102,241,0.25);
        }

    .recipe-filters__button {
        padding: 0.55rem 1.2rem;
        border-radius: 999px;
        border: none;
        background: linear-gradient(135deg,#6366F1,#EC4899);
        color: #FFF;
        font-weight: 600;
        cursor: pointer;
        font-size: 0.9rem;
    }

        .recipe-filters__button:hover {
            opacity: 0.9;
        }

    .recipe-filters__button--secondary {
        background: #F3F4F6;
        color: #374151;
        border: 1px solid #D1D5DB;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        justify-content: center;
    }

        .recipe-filters__button--secondary:hover {
            background: #E5E7EB;
        }

    /* GRID */
    .recipe-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
        gap: 1.25rem;
    }

    /* CARD */
    .recipe-card {
        background-color: #FFFFFF;
        border-radius: 18px;
        overflow: hidden;
        border: 1px solid #E5E7EB;
        box-shadow: 0 14px 30px rgba(15, 23, 42, 0.06);
        display: flex;
        flex-direction: column;
        transition: transform 0.18s ease, box-shadow 0.18s ease;
    }

        .recipe-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 45px rgba(15, 23, 42, 0.12);
        }

    .recipe-card__image-wrapper {
        aspect-ratio: 4 / 3;
        overflow: hidden;
    }

    .recipe-card__image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
    }

    .recipe-card__body {
        padding: 0.9rem 1rem 1rem;
        display: flex;
        flex-direction: column;
        gap: 0.4rem;
    }

    .recipe-card__title a {
        font-size: 1.05rem;
        font-weight: 700;
        color: #1D4ED8;
        text-decoration: none;
    }

        .recipe-card__title a:hover {
            text-decoration: underline;
        }

    .recipe-card__meta {
        font-size: 0.8rem;
        color: #6B7280;
        display: flex;
        flex-wrap: wrap;
        gap: 0.25rem;
        align-items: center;
    }

    .recipe-card__chip {
        padding: 0.1rem 0.55rem;
        border-radius: 999px;
        background-color: #EEF2FF;
        color: #4F46E5;
        font-weight: 600;
    }

    .recipe-card__difficulty {
        font-weight: 600;
    }

    .recipe-card__dot {
        margin: 0 2px;
    }

    .recipe-card__desc {
        font-size: 0.85rem;
        color: #4B5563;
        margin-top: 0.25rem;
        min-height: 3em;
    }

    .recipe-card__footer {
        margin-top: 0.6rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 0.5rem;
    }

    .recipe-card__author {
        display: flex;
        align-items: center;
        gap: 0.4rem;
        font-size: 0.85rem;
        color: #374151;
    }

    .recipe-card__avatar {
        width: 28px;
        height: 28px;
        border-radius: 999px;
        object-fit: cover;
    }

    .recipe-card__stats {
        display: flex;
        gap: 0.65rem;
        font-size: 0.8rem;
        color: #6B7280;
    }

    .recipe-pagination {
        margin-top: 1.5rem;
        display: flex;
        justify-content: center;
        gap: 0.75rem;
        font-size: 0.9rem;
        align-items: center;
    }

        .recipe-pagination a {
            color: #4F46E5;
            text-decoration: none;
        }

            .recipe-pagination a:hover {
                text-decoration: underline;
            }

    @@media (max-width: 640px) {
        .recipe-page {
            padding-inline: 0.75rem;
        }

        .recipe-card__body {
            padding-inline: 0.85rem;
        }

        .my-recipes-strip__list {
            padding-bottom: 0.15rem;
        }
    }
</style>

<div class="recipe-page">
    <div class="recipe-page__header">
        <h1 class="recipe-page__title">Browse Recipes</h1>

        <a asp-page="/Recipes/Create" class="recipe-page__create-btn">
            + Create recipe
        </a>
    </div>

   

    <form method="get" class="recipe-filters">
        <div class="recipe-filters__row">
            <input type="text"
                   name="Search"
                   value="@Model.Search"
                   placeholder="Search recipes..."
                   class="recipe-filters__search" />

            <select name="CategoryId" class="recipe-filters__select">
                <option value="">All categories</option>
                @foreach (var cat in Model.Categories)
                {
                    <option value="@cat.CategoryId"
                            selected="@(Model.CategoryId == cat.CategoryId)">
                        @cat.CategoryName
                    </option>
                }
            </select>

            <select name="SortBy" class="recipe-filters__select">
                <option value="newest"
                        selected="@(Model.SortBy == "newest")">
                    Newest
                </option>
                <option value="mostViewed"
                        selected="@(Model.SortBy == "mostViewed")">
                    Most viewed
                </option>
                <option value="mostLiked"
                        selected="@(Model.SortBy == "mostLiked")">
                    Most liked
                </option>
            </select>

            <button type="submit" class="recipe-filters__button">Filter</button>

            <a asp-page="./Index"
               class="recipe-filters__button recipe-filters__button--secondary">
                Reset
            </a>
        </div>
    </form>

    @if (Model.Recipes.Items.Any())
    {
        <div class="recipe-grid">
            @foreach (var recipe in Model.Recipes.Items)
            {
                var totalMinutes = (recipe.PrepTime ?? 0) + (recipe.CookTime ?? 0);
                var mainImage = string.IsNullOrEmpty(recipe.MainImageUrl)
                ? "https://placehold.co/600x360?text=Recipe"
                : recipe.MainImageUrl;
                var avatar = string.IsNullOrEmpty(recipe.AuthorAvatar)
                ? "https://placehold.co/40x40?text=U"
                : recipe.AuthorAvatar;

                <article class="recipe-card">
                    <div class="recipe-card__image-wrapper">
                        <img src="@mainImage"
                             alt="@recipe.Title"
                             class="recipe-card__image" />
                    </div>

                    <div class="recipe-card__body">
                        <h3 class="recipe-card__title">
                            <a asp-page="/Recipes/Details"
                               asp-route-id="@recipe.RecipeId">
                                @recipe.Title
                            </a>
                        </h3>

                        <p class="recipe-card__meta">
                            @if (!string.IsNullOrEmpty(recipe.CategoryName))
                            {
                                <span class="recipe-card__chip">@recipe.CategoryName</span>
                            }
                            @if (!string.IsNullOrEmpty(recipe.Difficulty))
                            {
                                <span class="recipe-card__dot">•</span>
                                <span class="recipe-card__difficulty">@recipe.Difficulty</span>
                            }
                        <span class="recipe-card__dot">•</span>
                        <span>@totalMinutes min</span>
                    </p>

                    <p class="recipe-card__desc">
                        @((recipe.Description ?? string.Empty).Length > 130
                                            ? (recipe.Description!.Substring(0, 130) + "…")
                                            : recipe.Description)
                </p>

                        <div class="recipe-card__footer">
                            <div class="recipe-card__author">
                                <img src="@avatar"
                                     alt="@recipe.AuthorName"
                                     class="recipe-card__avatar" />
                                <span>@recipe.AuthorName</span>
                            </div>

                            <div class="recipe-card__stats">
                                <span>❤ @recipe.LikesCount</span>
                                <span>👁 @recipe.ViewCount</span>
                                <span>@recipe.CreatedAt?.ToString("dd/MM/yyyy")</span>
                            </div>
                        </div>
                    </div>
                </article>
                }
        </div>

        <div class="recipe-pagination">
            @if (Model.Recipes.Page > 1)
            {
                <a asp-page="./Index"
                   asp-route-Search="@Model.Search"
                   asp-route-CategoryId="@Model.CategoryId"
                   asp-route-SortBy="@Model.SortBy"
                   asp-route-PageNumber="@(Model.Recipes.Page - 1)">
                    Prev
                </a>
            }

            <span>Page @Model.Recipes.Page / @Model.Recipes.TotalPages</span>

            @if (Model.Recipes.Page < Model.Recipes.TotalPages)
            {
                <a asp-page="./Index"
                   asp-route-Search="@Model.Search"
                   asp-route-CategoryId="@Model.CategoryId"
                   asp-route-SortBy="@Model.SortBy"
                   asp-route-PageNumber="@(Model.Recipes.Page + 1)">
                    Next
                </a>
            }
        </div>
    }
    else
    {
        <p>No recipes found.</p>
    }
</div>

